library(tidyverse)
library(dplyr)
lathe<-read_csv("Machine Tool contracts.csv")

## Rejig OKPD to new coding format
lathe <- lathe %>% 
  mutate(PRODUCT_OKPD = recode(PRODUCT_OKPD,
                               "[25.99.29.190]" = "01",
                               "[27.90.31.110]" = "02",
                               "[28.29.70.110]" = "03",
                               "[28.41.12.110]" = "04",
                               "[28.41.21.110]" = "05",
                               "[28.41.21.120]" = "06",
                               "[28.41.22.120]" = "07",
                               "[28.41.22.130]" = "08",
                               "[28.41.23.120]" = "09",
                               "[28.41.23.130]" = "10",
                               "[28.41.23.190]" = "11",
                               "[28.41.24.190]" = "12",
                               "[28.41.31.110]" = "13",
                               "[28.41.33.120]" = "14",
                               "[28.41.33.190]" = "15",
                               "[28.41.34.000]" = "16",
                               "[28.93.13.132]" = "17",
                               "[29.22.18.312]" = "18",
                               "[29.42.12.410]" = "19",
                               "[29.42.21.230]" = "20",
                               "[29.42.21.271]" = "21",
                               "[29.42.21.273]" = "22",
                               "[29.42.21.430]" = "23",
                               "[29.42.21.630]" = "24",
                               "[29.42.22.242]" = "25",
                               "[29.42.22.253]" = '26',
                               "[29.42.22.261]" = '27',
                               "[29.42.22.276]" = '28',
                               "[29.42.22.281]" = '29',
                               "[29.42.22.289]" = '30',
                               "[29.42.31.111]" = '31',
                               "[29.42.31.310]" = '32',
                               "[29.42.31.833]" = '33',
                               "[29.42.32.330]" = '34',
                               "[29.42.35.511]" = '35',
                               "[29.43.12.331]" = '36',
                               "[29.43.20.310]" = '37',
                               "[29.52.92.223]" = '38',
                               "[30.02.14.134]" = '39',
                               "[32.99.53.130]" = '40',
                               "[36.63.74.112]" = '41',
                               "[36.63.74.121]" = '42',
                               "[36.63.74.182]" = '43',
                               "[80.22.10.120]" = '44',
                               "[85.21.12.000]" = '45')) 
lathe <- lathe %>% rename("PRODUCT_TYPE" = "PRODUCT_OKPD")

#Is customer a defense industry entity? 
lathe <- lathe %>% mutate("CUST_DEF_IND" = CUSTOMER_INN)

lathe <- lathe %>% 
  mutate(CUST_DEF_IND = recode(CUST_DEF_IND,
                                            "3442110950" = "YES",
                                            "7701350013" = "NO",
                                            "6662079370" = "NO",
                                            "5047196566" = "YES",
                                            "5259077666" = "YES",
                                            "7017171342" = "YES",
                                            "6319031396" = "YES",
                                            "7839395419" = "YES",
                                            "6669012431" = "NO",
                                            "7449044990" = "YES",
                                            "6673189640" = "YES",
                                            "6623029538" = "YES",
                                            "9102059433" = "NO",
                                            "5506202219" = "YES",
                                            "6140022069" = "YES",
                                            "7721022959" = "NO",
                                            "7705002602" = "NO",
                                            "4027106964" = "YES",
                                            "5835094992" = "YES",
                                            "7802375889" = "YES",
                                            "7731084175" = "YES",
                                            "7111003056" = "YES",
                                            "545001919" = "YES",
                                            "5099000013" = "YES",
                                            "3301002920" = "NO",
                                            "7452033815" = "YES",
                                            "7452001468" = "NO",
                                            "3232000278" = "NO",
                                            "7705596339" = "NO",
                                            "7728795443" = "YES",
                                            "7804478424" = "YES",
                                            "6612011546" = "YES",
                                            "6453104288" = "YES",
                                            "7717022177" = "YES",
                                            "7404011096" = "NO",
                                            "7422000957" = "NO",
                                            "6666000100" = "YES",
                                            "2128054356" = "NO",
                                            "6606004237" = "NO",
                                            "5836636246" = "YES",
                                            "5012009279" = "YES",
                                            "6829024766" = "YES",
                                            "1831032740" = "NO",
                                            "7402006277" = "YES",
                                            "5835049799" = "YES",
                                            "4502003242" = "NO",
                                            "5504000055" = "NO",
                                            "5918214069" = "NO",
                                            "7719014460" = "NO",
                                            "7730087409" = "NO",
                                            "5027030450" = "YES"))

#organize variable columns
lathe <- lathe[, c(1,7,2,4,3,10,11,12,5,6,8,9)] 
lathe <- lathe[, c(1,2,3,4,5,6,13,7,8,9,10,11,12)] 

#make null values consistent
lathe[is.na(lathe)] <- "[]"
lathe[lathe == "[]"] <- "[NULL]"
write_csv(lathe, "lathes.csv")

